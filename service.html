<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="js/html5shiv.js"></script>
    <script type="text/javascript" src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/animate.css"/>
    <link rel="stylesheet" href="js/layui/css/layui.css">
    <title>河南省中和信医用设备有限公司</title>
    <style>
        .layui-upload-img {
            width: 100px;
            height: 100px;
        }
    </style>
</head>

<body>
<div class="container service">
    <div class="header">
        <div class="logo cleafix">
            <img src="img/logo1.png" alt="" class="logo1">
            <img src="img/logo2.png" alt="" class="logo2">
        </div>
        <div class="tab cleafix">
            <script id="titleList" type="text/html">
                {{each list as item index}}
                <a class="item" href="{{item.urlName}}.html">
                    {{item.name}}
                </a>
                {{/each}}
            </script>
        </div>
    </div>
    <div class="body">
        <div class="banner">
            <img src="img/service1.png" alt="">
        </div>
        <div class="content">
            <div class="button-wrappper">
                <div class="button choosed" code="tabpane1">营销方案</div>
                <div class="button" code="tabpane2">售后服务</div>
                <div class="button big" code="tabpane3">客户满意度调查</div>
                <div class="button" code="tabpane4">投诉举报</div>
            </div>
            <div class="list-wrapper">
                <div class="tabpane tabpane1">
                    <div class="list cleafix">
                        <script id="productList" type="text/html">
                            {{each productList as item index}}
                            <div class="item" index="{{index}}">
                                <div class="img-wrapper">
                                    {{if item.imgUrl}}
                                    <img src="http://localhost:8128{{item.imgUrl}}" alt="">
                                    {{else}}
                                    <img src="img/mark.jpg" alt="" style="width:100%;height:100%;">
                                    {{/if}}
                                </div>
                                <div class="title-wrapper">
                                    <div class="title">{{item.name}}</div>
                                    <div class="more">MORE+</div>
                                </div>
                            </div>
                            {{/each}}
                        </script>
                    </div>
                    <div class="introduction">
                        <div class="detail">

                        </div>
                    </div>
                </div>
                <div class="tabpane tabpane2">
                </div>
                <div class="tabpane tabpane3">
                    <h2 style="text-align:center;margin-bottom: 10px;">顾客满意度调查表</h2>
                    <p style="font-size: 12px;margin-left: 1.5rem;margin-bottom: 5px;">注：
                        每题分值为1-5分，请结合自身满意度进行打分，谢谢配合！</p>
                    <div class="table">
                        <div class="tr tableTitle cleafix">
                            <div class="td td1">编号</div>
                            <div class="td td2">调查内容</div>
                            <div class="td td3">得分</div>
                        </div>
                        <div class="tr total cleafix">
                            <div class="td td1">总分</div>
                            <div class="td td2"></div>
                        </div>
                        <div class="tr last cleafix">
                            <div style="margin-bottom: 5px;">您认为我公司哪些方面还需要进一步改进，您的建议是：</div>
                            <textarea placeholder="请输入" class="layui-textarea suggestion"></textarea>
                        </div>
                        <div class="cleafix last">
                            <div class="infor"><span>单位名称:</span><input type="text" class="layui-input unit"></div>
                            <div class="infor"><span>联系人:</span><input type="text" class="layui-input name"></div>
                            <div class="infor"><span>电话:</span><input type="text" class="layui-input tel"></div>
                        </div>
                        <script id="research" type="text/html">
                            {{each data as value index}}
                            <div class="tr cleafix">
                                <div class="td td1">{{value.bh}}</div>
                                <div class="td td2">{{value.wtnr}}</div>
                                <div class="td td3"><input type="text" class="layui-input" id="{{'input'+index}}"
                                                           index="{{index}}" onchange="scoreInput(this)"></div>
                            </div>
                            {{/each}}
                        </script>
                    </div>
                    <div style="text-align: center;margin-top: 10px;">
                        <button class="layui-btn" style="width:20%;" onclick="tableSubmit()"> 提交</button>
                    </div>
                </div>
                <div class="tabpane tabpane4">
                    <form class="layui-form" lay-filter="form4">
                        <div class="layui-form-item">
                            <label class="layui-form-label"><i style="color:#f00;margin-right: 2px;">*</i>投诉人姓名</label>
                            <div class="layui-input-block">
                                <input type="text" name="xm" lay-verify="required" autocomplete="off"
                                       placeholder="请输入投诉人姓名" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label"><i style="color:#f00;margin-right: 2px;">*</i>投诉人电话</label>
                            <div class="layui-input-block">
                                <input type="text" name="dh" lay-verify="required" lay-reqtext="请输入投诉人电话"
                                       placeholder="请输入投诉人电话" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">投诉人地区</label>
                            <div class="layui-input-block">
                                <input type="text" name="dq" placeholder="请输入投诉人地区" autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">投诉内容</label>
                            <div class="layui-input-block">
                                <textarea name="content" placeholder="请输入投诉内容" class="layui-textarea"></textarea>
                            </div>
                        </div>
<!--                        <div class="layui-form-item">-->
<!--                            <label class="layui-form-label">上传</label>-->
<!--                            <div class="layui-input-block">-->
<!--                                <input type="radio" name="sex" value="1" title="上传图片" checked="" lay-filter="radio">-->
<!--                                <input type="radio" name="sex" value="2" title="上传视频" lay-filter="radio">-->
<!--                            </div>-->
<!--                        </div>-->
                        <div class="layui-form-item">
                            <div class="layui-input-block" style="display: none;">
                                <input type="text" name="imgUrl" placeholder="" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item uploadPic">
                            <label class="layui-form-label">上传图片</label>
                            <div class="layui-input-block">
                                <button name="imgUrl" type="button" class="layui-btn" id="picture">图片上传</button>
                                <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                                    预览图：
                                    <div class="layui-upload-list" id="demo2"></div>
                                </blockquote>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block" style="display: none;">
                                <input type="text" name="spUrl" placeholder="" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item uploadVideo" >
                            <label class="layui-form-label">上传视频</label>
                            <div class="layui-input-block">
                                <button type="button" class="layui-btn" id="video">上传视频</button>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block" style="text-align: center;margin-left: 0;">
                                <button class="layui-btn" lay-submit lay-filter="submit4" style="width:20%;">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <div class="footer">
        <p><span>版权所有: 河南省中和信医用设备有限公司</span><span style="margin-left: 10px;">备案号: (豫) -非经营性-2011-0006</span></p>
    </div>
</div>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script src="js/template.js"></script>
<script src="js/fontsize.js"></script>
<script src="js/layui/layui.js"></script>
<script src="js/operate.js"></script>
<script type="text/javascript">
    var dataList = '';
    $(function () {
        $('.button-wrappper').on('click', '.button', function () {
            $('.button-wrappper').children().removeClass('choosed')
            $(this).addClass('choosed')
            buttonType = $(this).attr('code')
            if (buttonType === 'tabpane1') {
                $('.list').show()
                $('.introduction').hide()
                getDataList1()
            } else if (buttonType === 'tabpane2') {
                getDataList2()
            } else {

            }
            $('.' + buttonType).show()
            $('.' + buttonType).siblings().hide()
        })
        $('.list').on('click', '.item', function () {
            $('.introduction').show()
            $('.list').hide()
            index = $(this).attr('index')
            $('.introduction .detail').html(dataList[index].content)
        })
        getDataList1()

        function getDataList1() {
            $.ajax({
                url: base_url + "/QdxData/yxfaDataList",
                dataType: "JSON",
                cache: false,
                success: function (res) {
                    var data = {
                        productList: res.data
                    }
                    var html = template('productList', data);
                    $('.list').html(html);
                    dataList = res.data;
                }
            })
        }

        function getDataList2() {
            $.ajax({
                url: base_url + "/QdxData/ShfwDataList",
                dataType: "JSON",
                cache: false,
                success: function (res) {
                    if(res.data.length>0){
                        $('.tabpane2').html(res.data[0].content);
                    }

                }
            })
        }

        layui.use('form', function () {
            var upload = layui.upload;
            var form = layui.form;
            upload.render({
                elem: '#picture',
                url:base_url +'/QdxData/addfile', //改成您自己的上传接口
                multiple: true,
                before: function (obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result){
                        $('#demo2').html('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                    });
                    layer.load();
                }, done: function (res) {
                    layer.closeAll('loading');
                    layer.msg('上传图片成功', {
                        time: 2000
                    })
                    form.val("form4", {'imgUrl': res.msg,})
                }
            });
            upload.render({
                elem: '#video',
                url: base_url +'/QdxData/addfile',
                accept: 'video',
                before: function (obj) { //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                    layer.load(); //上传loading
                },
                done: function (res) {
                    layer.closeAll('loading');
                    layer.msg('上传视频成功', {
                        time: 2000
                    })
                    form.val("form4", {'spUrl': res.msg,})
                }
            });

            //监听提交
            form.on('submit(submit4)', function (data) {
                layer.open({
                    content: '确定提交吗',
                    yes: function (index, layero) {
                        console.log(data)
                        submit(data)
                        layer.close(index); //如果设定了yes回调，需进行手工关闭
                        form.val(
                            "form4", {
                            "xm": ""
                            ,"dh": ""
                            ,"dq": ''
                            ,"content": ''
                            ,"imgUrl": ''
                            ,"spUrl": ""
                        });
                    }
                });

                return false;
            });
        });


        function submit(data) {
            layer.load();
            var data1 = data.field
            $.ajax({
                url: base_url + "/QdxData/touSuAdd",
                type: "post",
                dataType: "JSON",
                cache: false,
                data: data1,
                success: function (res) {
                    layer.closeAll();
                    layer.msg(res.msg, {
                        time: 2000
                    })
                }
            })
        }


        $.ajax({
            url: base_url + "/QdxData/KhmydcMbDataList",
            dataType: "JSON",
            cache: false,
            success: function (res) {
                var data = {
                    data: res.data
                }
                tableList = data.data;
                var html = template('research', data);
                $('.tableTitle').after(html);
            }
        })


    })
    var tableList = [];

    function scoreInput(that) {
        var index = $(that).attr('index')
        var value = $(that).val()

        if (isNaN(value)) {
            layer.msg("请输入数字！", {
                icon: 2,
                time: 1000
            });
            $(that).val('')
            return;
        } else if (Number(value) > 5 || Number(value) < 1) {
            layer.msg("请输入1-5！", {
                icon: 2,
                time: 1000
            });
            $(that).val('')
            return;
        } else {
            tableList[index].pf = Number(value)
            var total = 0;
            tableList.forEach((item) => {
                total += Number(item.pf)?Number(item.pf):0
            })
            $('.total .td2').html(total)
        }
    }

    function tableSubmit() {
        var total = Number($('.total .td2').html());
        if (total == 0) {
            layer.msg("请进行打分再提交！", {
                icon: 2,
                time: 1000
            });
        } else {
            var list=[]
            tableList.forEach(function (item,index) {
                var obj={}
                obj.khmydcTitleId=item.id;
                obj.wtnr=item.wtnr;
                obj.pf=item.pf;
                list.push(obj)
            })
            var data1={
                content:$('.suggestion').val(),
                dh:$('.tel').val(),
                dwmc:$('.unit').val(),
                lxr:$('.name').val(),
                zf:Number($('.total .td2').html()),
                khmydcLisdataList:list
            }
            console.log(data1)
            layer.load();
            $.ajax({
                url: base_url + "/QdxData/addKhmydcTitleData",
                type: "post",
                dataType: "JSON",
                cache: false,
                data: {json:JSON.stringify(data1)},
                success: function (res) {
                    layer.closeAll();
                    layer.msg(res.msg, {
                        time: 2000
                    })
                }
            })
        }
    }
</script>
</body>
</html>
